---
// Components
import Seo from '../components/Seo.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import ErrorBoundary from '../components/ErrorBoundary.jsx';

import '../styles/global.css';

import BackgroundAnimation from '../components/BackgroundAnimation.jsx';

export interface Props {
  title: string;
  description?: string;
}

const { title, description } = Astro.props;
const currentPath = Astro.url.pathname;
const isZh = currentPath.startsWith('/zh');
const lang = isZh ? 'zh' : 'en';
const defaultDesc = isZh ? "企业级 AI 解决方案平台" : "Enterprise AI Solution Platform";
---

<!DOCTYPE html>
<html lang={lang}>
  <head>
    <Seo title={title} description={description || defaultDesc} />
    <script is:inline>
      const theme = (() => {
        if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
          return localStorage.getItem('theme');
        }
        if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
          return 'dark';
        }
        return 'light';
      })();
    
      if (theme === 'dark') {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
    
      window.localStorage.setItem('theme', theme);
    </script>
  </head>

  <body class="bg-canvas-white dark:bg-canvas-black font-inter text-text-primary dark:text-text-inverse min-h-screen overflow-x-hidden selection:bg-accent-blue selection:text-white antialiased relative transition-colors duration-300">
    <BackgroundAnimation client:only="react" />
    <Header />
    <ErrorBoundary client:load>
      <main>
        <slot />
      </main>
    </ErrorBoundary>
    <Footer />

    <style is:global>
      .glass-nav {
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: saturate(180%) blur(20px);
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      }
      :global(.dark) .glass-nav {
        background: rgba(0, 0, 0, 0.7);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }
    </style>
  </body>
</html>
